<div class="report-container">
    <div class="header-actions no-print">
        <h1>My Performance Report</h1>
        <button mat-raised-button color="primary" (click)="downloadReport()">
            <mat-icon>download</mat-icon> Download Report
        </button>
    </div>

    <div *ngIf="isLoading" class="loading-state">
        <p>Loading report data...</p>
    </div>

    <div *ngIf="errorMessage" class="error-message">
        {{ errorMessage }}
    </div>

    <div *ngIf="report && !isLoading" class="report-content" id="print-section">

        <div class="report-header-print only-print">
            <h2>Agent Performance Report</h2>
            <p><strong>Agent:</strong> {{ report.agentName }}</p>
            <p><strong>Date:</strong> {{ report.assignedToday | date:'mediumDate' }} (Today)</p>
            <!-- Using any date field to show current date context if needed, or just today-->
        </div>

        <!-- Summary Cards -->
        <div class="summary-grid">
            <mat-card class="summary-card">
                <mat-card-header>
                    <mat-card-title>{{ report.totalAssigned }}</mat-card-title>
                    <mat-card-subtitle>Total Assigned</mat-card-subtitle>
                </mat-card-header>
            </mat-card>

            <mat-card class="summary-card">
                <mat-card-header>
                    <mat-card-title>{{ report.resolvedCount }}</mat-card-title>
                    <mat-card-subtitle>Total Resolved</mat-card-subtitle>
                </mat-card-header>
            </mat-card>

            <mat-card class="summary-card highlight-bad">
                <mat-card-header>
                    <mat-card-title>{{ report.slaBreachedCount }}</mat-card-title>
                    <mat-card-subtitle>SLA Breached</mat-card-subtitle>
                </mat-card-header>
            </mat-card>

            <mat-card class="summary-card">
                <mat-card-header>
                    <mat-card-title>{{ report.avgResolutionHours }}h</mat-card-title>
                    <mat-card-subtitle>Avg Resolution Time</mat-card-subtitle>
                </mat-card-header>
            </mat-card>
        </div>

        <div class="daily-metrics">
            <h3>Today's Activity</h3>
            <div class="metrics-row">
                <div class="metric-item">
                    <span class="label">Assigned Today:</span>
                    <span class="value">{{ report.assignedToday }}</span>
                </div>
                <div class="metric-item">
                    <span class="label">Resolved Today:</span>
                    <span class="value">{{ report.resolvedToday }}</span>
                </div>
            </div>
        </div>

        <mat-divider class="divider"></mat-divider>

        <div class="charts-section">
            <div class="chart-container">
                <h3>SLA Compliance</h3>
                <ngx-charts-pie-chart [scheme]="slaColorScheme" [results]="slaData" [gradient]="true" [legend]="true"
                    [labels]="true" [doughnut]="true">
                </ngx-charts-pie-chart>
            </div>
        </div>

        <mat-divider class="divider"></mat-divider>

        <div class="escalated-section" *ngIf="report.escalatedTickets?.length > 0">
            <h3>Escalated / Breached Tickets</h3>
            <table mat-table [dataSource]="report.escalatedTickets" class="mat-elevation-z0 full-width-table">

                <ng-container matColumnDef="id">
                    <th mat-header-cell *matHeaderCellDef> ID </th>
                    <td mat-cell *matCellDef="let t"> #{{t.ticketId}} </td>
                </ng-container>

                <ng-container matColumnDef="title">
                    <th mat-header-cell *matHeaderCellDef> Title </th>
                    <td mat-cell *matCellDef="let t"> {{t.title}} </td>
                </ng-container>

                <ng-container matColumnDef="elapsed">
                    <th mat-header-cell *matHeaderCellDef> Time Elapsed </th>
                    <td mat-cell *matCellDef="let t" class="text-danger"> {{t.hoursElapsed}} hrs </td>
                </ng-container>

                <ng-container matColumnDef="assignedTo">
                    <th mat-header-cell *matHeaderCellDef> Assigned To </th>
                    <td mat-cell *matCellDef="let t"> {{t.assignedTo}} </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
        </div>

        <div class="empty-state" *ngIf="report.escalatedTickets?.length === 0">
            <p>No currently escalated tickets. Great job!</p>
        </div>
    </div>
</div>